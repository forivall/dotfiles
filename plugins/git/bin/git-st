#!/usr/bin/env zsh

# a nice, short useful git status alternative.

autoload colors && colors

cd "$GIT_PREFIX"

# if no paths are defined, default to displaying only '.' for untracked files
args="$@"
default_paths () {
  for r in $args
  do
    if [[ "$r" == "--" ]]
      then return 1
    fi
    if [[ "$r" == -* ]]
      then continue
    fi
    return 1
  done
  echo '--' ':'
  return 0
}

git -c 'color.status=always' status -b -s -uno "$@" &&
git status --porcelain "$@" $(default_paths) |
  rg '^\?\? ' | sd '^\?\? ' "${fg[magenta]}" | sd '$' "${reset_color}" |
  git column --mode=dense --padding=2
