#!/usr/bin/env zsh

set -euo pipefail

__plugin_dirname=${0:a:h:h}

autoload colors && colors

git() {
  if [[ $1 != rev-parse ]]; then
    echo '>' git $@
  fi
  echo -n "Continue? (y/N) "
  read -k 1 yn
  echo
  [[ $yn == y ]] && command git $@
}

branch_name=$(git rev-parse --symbolic --revs-only $@ | tail -n1)
remote_rev=$(git rev-parse --symbolic-full-name ${branch_name}@{u})
remote_rev=${remote_rev#refs/remotes/}
remote_name=${remote_rev%%/*}
remote_branch=${remote_rev#*/}

git branch --delete $@
git push $remote_name :$remote_branch
