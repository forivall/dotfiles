#!/usr/bin/env zsh

__plugin_dirname=${0:a:h:h}

filewait=kqwait
if ((+commands[inotifywait])); then
  filewait=inotifywait
fi

changed=$(
  $filewait .git/index $(
    comm -23 <(git diffc --name-only --diff-filter=AMCR $@) <(git diff --name-only --diff-filter=D $@)
  )
)
if [[ $changed == '- '* ]] ; then
  git diffc --name-only --diff-filter=AMCR $@
else 
  echo $changed
fi
